TODO

- [ ] 支持数字编号
  - [ ] 思路：添加一个命令，把当前文档的脚注转化为数字编号，考虑到思源的动态加载机制，应该是把当前文档导出kramdown文本，直接对kramdown进行处理。注意，导出kramdown需要用span样式（https://github.com/siyuan-note/siyuan/issues/13183）
    1. 首先先用正则搜索形如`<sup>((20241118190709-lx2usll "注"))</sup>{: style="--memo: 1"}`的块引，根据搜索，获取每个被引用的块id，考虑到可能会存在重复，只考虑这个id在整个文档第一次出现的顺序进行排序。排序后将块引中的`"注"`改为单引号包裹的对应块id的序号（思源笔记kramdown语法单引号代表动态锚文本）。
    2. 把脚注引用变为动态锚文本（块引由原来的s改为d）
- [ ] 需要改进下如何做到选择同一文本，如果已经有脚注了，脚注块引应该放在最后，而不是放在最前
  - [ ] 用protyle.insert 插入块引（不需要了，因为插入块引不需要有选中文本，用setInlineMark就行）
  - [ ] 需要获取range的位置，然后根据位置判断是否有脚注，如果有脚注，就插入在脚注后面
  - [ ] 不过也可以选中全部文本，插入脚注，不过获取的selection文本需要排除已经添加的脚注，这样更简单一点，也更加自由，只需要对selection文本进行处理，这个应该是好处理的
  - [ ] 如果选中的文本末尾不包含脚注，则应该新增的脚注要放在所有脚注后面，如果选中的文本末尾包含脚注，就直接放到当前选中文本的后面，这样就非常自由
- [ ] 优化导出到微信公众号
  - [ ] 去除脚注块引锚文本，只保留导出
  - [ ] 不导出脚注内容，只显示思源的脚注
- [ ] 自定义选中文本的样式
  - [ ] 参考<https://github.com/zxhd863943427/siyuan-plugin-memo>，添加css样式
  

## v1.0.6 / 2024.11.20
- ✨脚注内容模板新增`${refID}`，代表选中文本所在的块ID，现在可以通过模板插入选中文本所在的块链接了，方便在脚注内容里直接跳转到原来的块
    ```markdown
    {{{row
    > ${selection} [[↩️]](siyuan://blocks/${refID})
    
    ${content}
    }}}
    {: style="border: 2px dashed var(--b3-border-color);"}
  ```
  ![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/思源笔记脚注插件支持直接跳转到原来的块-2024-11-20.gif)


## v1.0.5 / 2024.11.20
- ✨支持设置脚注块引为块超链接
- ✨支持设置脚注放在子文档

## v1.0.4 / 2024.11.20
- ✨ 脚注内容默认模板完善，用kramdown语法设置边框样式
    ```markdown
    {{{row
    > ${selection}
    
    ${content}
    }}}
    {: style="border: 2px dashed var(--b3-border-color);"}
    ```
- ✨脚注块引默认模板完善，从“注”改为“[注]”
- 📝完善文档

## v1.0.3 / 2024.11.19

- ✨ 脚注块引用自定义属性custom-footnote实现，不用style

## v1.0.2 / 2024.11.19

- ✨对选中文本（变量：selection）进行过滤，不包含脚注锚文本，这样方便对重叠的内容进行脚注

## v1.0.1 / 2024.11.19

- 📝更新README

## v1.0.0 / 2024.11.18

**实现基本功能**
- 设置个性化设置
  - **脚注存放位置**：可以设置存放在当前文档或者指定文档，默认为`当前文档`
  - **选中文本的样式**：可以选中加粗、高亮、斜体、下划线样式，默认：`无样式`
  - **插入脚注的顺序**：顺序或者倒序，默认：`顺序`
  - **脚注标题**：设置存放脚注的标题，默认：`脚注`
  - **脚注块引锚文本**：设置脚注引用的锚文本，默认：`注`
  - **脚注内容模板**：设置脚注的模板，推荐使用引述块或超级块组合，保证脚注内容属于同一个块，默认使用嵌套引述块模板，可以自行更改，`${selection}`表示选中文本的内容，`${content}`代表脚注内容占位

    ![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/PixPin_2024-11-18_16-46-42-2024-11-18.png)
- **支持删除脚注**
  ![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/PixPin_2024-11-18_15-35-31-2024-11-18.png)