## âœ¨åŠŸèƒ½

ä½¿ç”¨æ€æºçš„å—å¼•å®ç°è„šæ³¨å’Œå¤‡æ³¨åŠŸèƒ½

![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/è„šæ³¨æ’ä»¶åŠŸèƒ½é¢„è§ˆ-2024-12-02.gif)

## ğŸ“æ›´æ–°æ—¥å¿—

å®Œæ•´æ›´æ–°æ—¥å¿—è§ï¼š[ChangeLog](https://fastly.jsdelivr.net/gh/Achuan-2/siyuan-plugin-blockref-footnote/CHANGELOG.md)

## ğŸ“æ’ä»¶è®¾ç½®

> æ€æºç¬”è®°ä½¿ç”¨æœ¬æ’ä»¶çš„ç‰ˆæœ¬è¦æ±‚ï¼š>v3.2.0

**æœ¬æ’ä»¶æ”¯æŒé«˜åº¦è‡ªå®šä¹‰åŒ–ï¼Œæ”¯æŒçš„è®¾ç½®å¦‚ä¸‹ï¼š**

* **è„šæ³¨å­˜æ”¾è®¾ç½®**

  * **è„šæ³¨å­˜æ”¾ä½ç½®**ï¼šå¯ä»¥è®¾ç½®è„šæ³¨å­˜æ”¾åœ¨å½“å‰æ–‡æ¡£ã€æŒ‡å®šæ–‡æ¡£ã€å­æ–‡æ¡£ã€çˆ¶å—åã€‚é»˜è®¤ä¸º `å½“å‰æ–‡æ¡£`
  * **æŒ‡å®šæ–‡æ¡£çš„æ–‡æ¡£ID** ï¼šå½“è„šæ³¨å­˜æ”¾ä½ç½®ä¸ºâ€œæŒ‡å®šæ–‡æ¡£â€æ—¶ï¼Œè®¾ç½®æŸä¸ªæ–‡æ¡£å­˜æ”¾æ‰€æœ‰çš„è„šæ³¨
  * **å½“å‰æ–‡æ¡£çš„è„šæ³¨å®¹å™¨æ ‡é¢˜**ï¼šå½“è„šæ³¨å­˜æ”¾ä½ç½®ä¸ºâ€œå½“å‰æ–‡æ¡£â€æ—¶ï¼Œè®¾ç½®å­˜æ”¾è„šæ³¨çš„æ ‡é¢˜
  * **æŒ‡å®šæ–‡æ¡£çš„è„šæ³¨å®¹å™¨æ ‡é¢˜**ï¼šå½“è„šæ³¨å­˜æ”¾ä½ç½®ä¸ºâ€œæŒ‡å®šæ–‡æ¡£â€æ—¶ï¼Œè®¾ç½®å­˜æ”¾è„šæ³¨çš„æ ‡é¢˜ã€‚
  * **å­æ–‡æ¡£çš„è„šæ³¨å®¹å™¨æ ‡é¢˜**ï¼šå½“è„šæ³¨å­˜æ”¾ä½ç½®ä¸ºâ€œå­æ–‡æ¡£â€æ—¶ï¼Œè®¾ç½®å­˜æ”¾è„šæ³¨çš„æ–‡æ¡£æ ‡é¢˜å
  * **æ˜¯å¦è‡ªåŠ¨æ›´æ–°è„šæ³¨å®¹å™¨æ ‡é¢˜**ï¼šæ¯æ¬¡åˆ›å»ºè„šæ³¨æ˜¯å¦ä¼šè‡ªåŠ¨æ›´æ–°è„šæ³¨å®¹å™¨æ ‡é¢˜ç¬¦åˆè®¾ç½®çš„æ¨¡æ¿
  * **æ’å…¥è„šæ³¨çš„é¡ºåº**ï¼šé¡ºåºæˆ–è€…å€’åºã€‚é»˜è®¤ï¼š`é¡ºåº`
* **è„šæ³¨æ ·å¼è®¾ç½®**

  * **è„šæ³¨å¼•ç”¨æ ·å¼**ï¼šè„šæ³¨å¼•ç”¨çš„æ ·å¼ï¼šâ€œå—å¼•â€æˆ–â€œå—é“¾æ¥â€ã€‚é»˜è®¤ï¼š`å—å¼•`
  * **è„šæ³¨å—å¼•é”šæ–‡æœ¬**ï¼šè®¾ç½®è„šæ³¨å¼•ç”¨çš„é”šæ–‡æœ¬ã€‚é»˜è®¤ï¼š`[æ³¨]`
  * **é€‰ä¸­æ–‡æœ¬çš„æ ·å¼**ï¼šé€‰æ‹©æ— æ ·å¼æˆ–è‡ªå®šä¹‰æ ·å¼ã€‚é»˜è®¤ï¼š`æ— æ ·å¼`ã€‚
  * **è„šæ³¨è‡ªåŠ¨æ•°å­—ç¼–å·**ï¼šä½¿ç”¨æ•°å­—ç¼–å·ï¼ˆå¦‚[1], [2]ç­‰ï¼‰æ›¿ä»£è‡ªå®šä¹‰é”šæ–‡æœ¬ã€‚å¼€å¯åæ¯æ¬¡æ–°å»ºå’Œåˆ é™¤è„šæ³¨ä¼šè‡ªåŠ¨å¯¹æ‰€æœ‰è„šæ³¨é‡æ–°æ’åºç¼–å·ã€‚æ³¨æ„ï¼šç›®å‰å¼€å¯æ­¤é¡¹ï¼Œå½“è„šæ³¨æ•°é‡è¶Šå¤šï¼Œæ’åºè€—æ—¶è¶Šé•¿ï¼Œä»‹æ„è¯·å‹¿å¼€å¯ã€‚
  * **è„šæ³¨å†…å®¹æ¨¡æ¿**ï¼šè®¾ç½®ç”Ÿæˆè„šæ³¨å†…å®¹çš„æ ·å¼ï¼Œæ¨èä½¿ç”¨åµŒå¥—å¼•è¿°å—æˆ–è¶…çº§å—æ¥å­˜æ”¾è„šæ³¨å†…å®¹ï¼Œä¿è¯è„šæ³¨å†…å®¹å±äºåŒä¸€ä¸ªå—ï¼Œ`${selection}`ä»£è¡¨é€‰ä¸­æ–‡æœ¬çš„å¯Œæ–‡æœ¬å†…å®¹ï¼Œ`${selection:text}`ä»£è¡¨é€‰ä¸­æ–‡æœ¬çº¯æ–‡æœ¬å†…å®¹ï¼Œ`${content}`ä»£è¡¨è„šæ³¨å†…å®¹å ä½ï¼Œ`${refID}`ä»£è¡¨é€‰ä¸­æ–‡æœ¬æ‰€åœ¨çš„å—çš„IDï¼Œ`${index}`è„šæ³¨ç¼–å·é»˜è®¤å¸¦åŸå—é“¾æ¥ï¼Œ`${index:text}`è„šæ³¨ç¼–å·çº¯æ–‡æœ¬ã€‚å¦å¤–å¯ä»¥ä½¿ç”¨kramdownè¯­æ³•è®¾ç½®è„šæ³¨å†…å®¹å—çš„å—æ ·å¼ã€‚
    * å…·ä½“ä½¿ç”¨è§åé¢çš„ã€å¦‚ä½•ä¿®æ”¹è„šæ³¨å†…å®¹å—çš„æ¨¡æ¿ã€‘
  * **è„šæ³¨å†…å®¹å—çš„åˆ«å**ï¼šè®¾ç½®è„šæ³¨å†…å®¹å—çš„åˆ«åï¼Œæç¤ºè¿™ä¸ªå—æ˜¯è„šæ³¨å†…å®¹ï¼Œè®¾ç½®ä¸ºç©ºåˆ™ä¸è®¾ç½®åˆ«åã€‚é»˜è®¤ä¸ºç©ºã€‚
  * **è‡ªå®šä¹‰æ ·å¼**ï¼šè‡ªå®šä¹‰è„šæ³¨å—å¼•ã€æ·»åŠ è„šæ³¨æ—¶é€‰ä¸­æ–‡å­—çš„æ ·å¼ã€è„šæ³¨å†…å®¹å—çš„æ ·å¼ã€‚
    * å…·ä½“ä½¿ç”¨è§åé¢çš„ã€å¦‚ä½•è‡ªå®šä¹‰è„šæ³¨æ ·å¼ã€‘
* **é‡ç½®è®¾ç½®**ï¼šé‡ç½®æ’ä»¶è®¾ç½®ä¸ºé»˜è®¤å€¼

## âš¡æ’ä»¶å‘½ä»¤é¢æ¿

æ‰“å¼€å‘½ä»¤é¢æ¿

ç›®å‰å·²æœ‰çš„å‘½ä»¤å¦‚ä¸‹ï¼š

- æ·»åŠ è„šæ³¨ï¼šæ·»åŠ è„šæ³¨åˆ°å½“å‰æ–‡æ¡£ï¼ˆå¯ä»¥ä¸é€‰æ‹©æ–‡å­—æ·»åŠ ï¼‰
- è„šæ³¨ç¼–å·ï¼šå°†å½“å‰æ–‡æ¡£çš„æ‰€æœ‰è„šæ³¨è½¬æ¢ä¸ºæ•°å­—ç¼–å·æ ·å¼
- è„šæ³¨å–æ¶ˆç¼–å·ï¼šå°†å½“å‰æ–‡æ¡£çš„æ‰€æœ‰è„šæ³¨è½¬æ¢ä¸ºè‡ªå®šä¹‰é”šæ–‡æœ¬æ ·å¼
- éšè—é€‰ä¸­æ–‡æœ¬çš„æ ·å¼ï¼šå°†å½“å‰æ–‡æ¡£çš„æ‰€æœ‰æ·»åŠ è„šæ³¨æ—¶é€‰ä¸­çš„æ–‡æœ¬è‡ªå®šä¹‰æ ·å¼éšè—
- æ˜¾ç¤ºé€‰ä¸­æ–‡æœ¬çš„æ ·å¼ï¼šå°†å½“å‰æ–‡æ¡£çš„æ‰€æœ‰æ·»åŠ è„šæ³¨æ—¶é€‰ä¸­çš„æ–‡æœ¬è‡ªå®šä¹‰æ ·å¼æ˜¾ç¤º

![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/PixPin_2024-12-08_16-59-02-2024-12-08.png)

å¯åœ¨è®¾ç½®ä¸­è‡ªè¡Œç»‘å®šå¿«æ·é”®ï¼š

![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/PixPin_2024-12-08_16-59-35-2024-12-08.png)

## ğŸ¤”æ’ä»¶ä½¿ç”¨ä»‹ç»

### å¦‚ä½•åŒæ—¶åˆ é™¤è„šæ³¨å¼•ç”¨å’Œè„šæ³¨å†…å®¹å—

æ’ä»¶æ”¯æŒåŒæ—¶åˆ é™¤è„šæ³¨å¼•ç”¨å’Œè„šæ³¨å†…å®¹ï¼Œå¯ä»¥åœ¨è„šæ³¨å¼•ç”¨å³é”®èœå•ï¼Œç‚¹å‡»ã€æ’ä»¶-åˆ é™¤è„šæ³¨ã€‘

![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/PixPin_2024-11-18_16-39-18-2024-11-18.png)

### å¦‚ä½•å¯¹åŒä¸€ä¸ªæ–‡æœ¬è¿›è¡Œå¤šæ¬¡å¤‡æ³¨

![](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/%E6%80%9D%E6%BA%90%E7%AC%94%E8%AE%B0%E8%84%9A%E6%B3%A8%E6%8F%92%E4%BB%B6%E6%94%AF%E6%8C%81%E5%AF%B9%E5%90%8C%E4%B8%80%E4%B8%AA%E6%96%87%E6%9C%AC%E8%BF%9B%E8%A1%8C%E5%A4%9A%E6%AC%A1%E5%A4%87%E6%B3%A8-2024-11-19.gif)

### å¦‚ä½•ä¿®æ”¹è„šæ³¨å†…å®¹å—çš„æ¨¡æ¿

ã€Œ**è„šæ³¨å†…å®¹æ¨¡æ¿ã€** èƒ½è®¾ç½®ç”Ÿæˆè„šæ³¨å†…å®¹çš„æ ·å¼ï¼Œæ¨èä½¿ç”¨åµŒå¥—å¼•è¿°å—æˆ–è¶…çº§å—æ¥å­˜æ”¾è„šæ³¨å†…å®¹ï¼Œä¿è¯è„šæ³¨å†…å®¹å±äºåŒä¸€ä¸ªå—ã€‚

æ’ä»¶è¿˜æä¾›äº†å˜é‡ï¼Œå¯ä»¥é€šè¿‡å˜é‡è‡ªç”±è®¾ç½®è„šæ³¨å†…å®¹å—çš„æ’ç‰ˆæ ·å¼ï¼š

* `${selection}`ä»£è¡¨é€‰ä¸­æ–‡æœ¬çš„å¯Œæ–‡æœ¬å†…å®¹ï¼Œ`${selection:text}`ä»£è¡¨é€‰ä¸­æ–‡æœ¬çº¯æ–‡æœ¬å†…å®¹
* `${content}`ä»£è¡¨è„šæ³¨å†…å®¹å ä½
* `${refID}`ä»£è¡¨é€‰ä¸­æ–‡æœ¬æ‰€åœ¨çš„å—çš„ID
* `${index}`è„šæ³¨ç¼–å·é»˜è®¤å¸¦åŸå—é“¾æ¥ï¼Œ`${index:text}`è„šæ³¨ç¼–å·çº¯æ–‡æœ¬ï¼Œä¸å¼€å¯è„šæ³¨ç¼–å·åŠŸèƒ½ï¼Œä¸ºå›ºå®šæ–‡æœ¬ï¼Œä¸­æ–‡é»˜è®¤ä¸º[æ³¨]ï¼Œè‹±æ–‡ä¸º[*]

ä¸‹é¢åˆ—ä¸¾ä¸€äº›ç”¨æˆ·å¯èƒ½ç”¨åˆ°çš„æ¨¡æ¿

* è„šæ³¨å†…å®¹ä¸ºå•ä¸ªå—

  ```markdown
  ${content}
  ```
* è„šæ³¨å†…å®¹ç”¨è¶…çº§å—åŒ…è£¹ï¼Œè¿™æ ·è„šæ³¨å†…å®¹å¯ä»¥æ˜¯å¤šä¸ªå—ï¼å¯ä»¥æ·»åŠ æ›´å¤šå†…å®¹

  ```markdown
  {{{row
  ${content}
  }}}
  ```
* è¶…çº§å—æ·»åŠ é€‰ä¸­çš„æ–‡æœ¬ï¼Œå¦å¤–æ·»åŠ è·³è½¬å›åŸå—çš„é“¾æ¥

  ```markdown
  {{{row
  > ${selection} [[â†©ï¸]](siyuan://blocks/${refID})

  ${content}
  }}}
  ```
* åµŒå¥—å¼•è¿°å—

  ```markdown
  >> ${selection} [[â†©ï¸]](siyuan://blocks/${refID})
  >> 
  > ğŸ’¡${content}
  ```
* åˆ†æ è¶…çº§å—ï¼šå·¦è¾¹æ˜¯è„šæ³¨ç¼–å·ï¼Œå³è¾¹æ˜¯è„šæ³¨å†…å®¹

  ä¼ ç»Ÿçš„è„šæ³¨æ ·å¼

  ```
  {{{col
  ${index}
  {: style="width: 2.5em; flex: 0 0 auto;"}

  {{{row
  ${content}
  }}}
  }}}

  ```

  å¼•è¿°å—æ ·å¼

  ```
  {{{col
  ${index}
  {: style="width: 2.5em; flex: 0 0 auto;"}

  {{{row
  > ${selection}

  ${content}
  }}}
  }}}

  ```
* ä½¿ç”¨åˆ—è¡¨é¡¹å­˜æ”¾å¼•ç”¨åŸå—çš„å—å¼•ï¼Œé”šæ–‡æœ¬ä¸ºé€‰ä¸­æ–‡å­—ï¼Œå¯ä»¥åœ¨å½“å‰æ–‡æ¡£çš„åé“¾é¢æ¿æŸ¥çœ‹æ‰€æœ‰è„šæ³¨

  ```markdown
  - ((${refID} "${selection:text}"))

    {{{row
    ${content}
    }}}
  ```

- æ’ä»¶è¿˜å¯ä»¥ä½¿ç”¨kramdownè¯­æ³•è®¾ç½®è„šæ³¨å†…å®¹å—çš„å—æ ·å¼ã€‚ä¾‹å¦‚ï¼šæˆ‘ç”¨è¯¥è¯­æ³•ä¸ºè¶…çº§å—æ·»åŠ è™šçº¿æ¡†æ ·å¼

  ```markdown
  {{{row
  > ${selection} [[â†©ï¸]](siyuan://blocks/${refID})

  ${content}
  }}}
  {: style="border: 2px dashed var(--b3-border-color);"}
  ```
- æ’ä»¶ä¹Ÿæ”¯æŒç”¨ `${{...}}`æ¥æ¸²æŸ“sprigè¯­æ³•ã€‚æ¯”å¦‚ä½ å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•æ’å…¥å½“å‰æ—¶é—´

  ```markdown
  >> ${{now | date "20060102 15:04:05"}} æ‘˜æŠ„
  >> ${selection} [[â†©ï¸]](siyuan://blocks/${refID})
  >> 
  > ğŸ’¡${content}
  ```

### å¦‚ä½•è‡ªå®šä¹‰è„šæ³¨æ ·å¼

æ’ä»¶æ·»åŠ çš„å†…å®¹éƒ½å«æœ‰è‡ªå®šä¹‰å±æ€§

* è„šæ³¨å¼•ç”¨ï¼š`span[custom-footnote]`
* è„šæ³¨å†…å®¹å—ï¼š`div[custom-plugin-footnote-content]`
* å¦‚æœè®¾ç½®äº†é€‰ä¸­æ–‡æœ¬çš„æ ·å¼ä¸ºè‡ªå®šä¹‰æ ·å¼ï¼Œæ·»åŠ è„šæ³¨æ—¶é€‰ä¸­çš„æ–‡æœ¬æœ‰ï¼š`span[data-type*="custom-footnote-selected-text"]`

æ ¹æ®è‡ªå®šä¹‰å±æ€§ï¼Œä½¿ç”¨cssä»£ç å³å¯é’ˆå¯¹æ€§ä¿®æ”¹æ’ä»¶æ·»åŠ çš„å†…å®¹æ ·å¼

ä¾‹å¦‚ï¼š

è‡ªå®šä¹‰è„šæ³¨å¼•ç”¨ä¿®æ”¹ä¸ºï¼šç»¿è‰²èƒŒæ™¯ï¼Œç»¿è‰²æ–‡å­—é¢œè‰²ã€‚

```
/* è‡ªå®šä¹‰è„šæ³¨å¼•ç”¨æ ·å¼ */
.protyle-wysiwyg [data-node-id] span[custom-footnote],
.protyle-wysiwyg [data-node-id] span[data-type*="block-ref"][custom-footnote],
.protyle-wysiwyg [data-node-id] span[data-ref*="siyuan://blocks"][custom-footnote] {
    /* è®¾ç½®èƒŒæ™¯è‰² */
    background-color: var(--b3-card-success-background);
  
    /* è®¾ç½®æ–‡å­—é¢œè‰² */
    color: var(--b3-card-success-color) !important;
  
    /* ç§»é™¤è¾¹æ¡† */
    border: none!important;
  
    /* è®¾ç½®å·¦å³å¤–è¾¹è· */
    margin: 0 1px;
  
    /* è®¾ç½®åœ†è§’ */
    border-radius: 3px;
}
```

è‡ªå®šä¹‰è„šæ³¨å†…å®¹å—ï¼šè®¾ç½®å­—ä½“å¤§å°ä¸º0.8emï¼Œå­—ä½“é¢œè‰²ä¸ºç°è‰²

```
/* è‡ªå®šä¹‰è„šæ³¨å†…å®¹å—æ ·å¼ */
.protyle-wysiwyg [data-node-id][custom-plugin-footnote-content] {
    /* è®¾ç½®å­—ä½“å¤§å° */
    font-size: 0.8em;
  
    /* è®¾ç½®æ–‡å­—é¢œè‰² */
    color: var(--b3-font-color5);
}
```

## ğŸ™è‡´è°¢

* [https://github.com/zxhd863943427/siyuan-plugin-memo](https://github.com/zxhd863943427/siyuan-plugin-memo)ï¼šæœ€åˆåŸºäºè¯¥æ’ä»¶è¿›è¡Œæ”¹è¿›ï¼Œæ·»åŠ äº†æ›´å¤šåŠŸèƒ½å’Œé…ç½®é¡¹
* [https://github.com/siyuan-note/plugin-sample-vite-svelte](https://github.com/siyuan-note/plugin-sample-vite-svelte)ï¼šä½¿ç”¨çš„æ’ä»¶æ¨¡æ¿ï¼Œå¤§å¹…æé«˜å¼€å‘æ•ˆç‡
* [Wetoria (Vip)](https://github.com/Wetoria) çš„æ’ä»¶å¼€å‘æŒ‡å¯¼

## â¤ï¸ ç”¨çˆ±å‘ç”µ

å¦‚æœå–œæ¬¢æˆ‘çš„æ’ä»¶ï¼Œæ¬¢è¿ç»™GitHubä»“åº“ç‚¹starå’Œå¾®ä¿¡èµèµï¼Œè¿™ä¼šæ¿€åŠ±æˆ‘ç»§ç»­å®Œå–„æ­¤æ’ä»¶å’Œå¼€å‘æ–°æ’ä»¶ã€‚

ç»´æŠ¤æ’ä»¶è´¹æ—¶è´¹åŠ›ï¼Œä¸ªäººæ—¶é—´å’Œç²¾åŠ›æœ‰é™ï¼Œä¼˜å…ˆè€ƒè™‘èµèµç”¨æˆ·æçš„åŠŸèƒ½å»ºè®®å’Œbugåé¦ˆ

ç´¯ç§¯èµèµ50å…ƒçš„æœ‹å‹å¦‚æœæƒ³åŠ æˆ‘å¾®ä¿¡ï¼Œå¯ä»¥å‘é‚®ä»¶åˆ°achuan-2@outlook.comæ¥è¿›è¡Œå¥½å‹ç”³è¯·ï¼ˆèµèµè¾¾ä¸åˆ°50å…ƒçš„ï¼Œæˆ‘ä¸ä¼šå›å¤é‚®ä»¶å’ŒåŠ å¥½å‹å“¦ï¼Œå› ä¸ºä¸æƒ³å½“å…è´¹å®¢æœï¼‰

![img](https://fastly.jsdelivr.net/gh/Achuan-2/PicBed/assets/20241118182532-2024-11-18.png)
